{% extends "base_template.html" %} <!-- extends block establishes the inheritance link between this content and base_template -->
{% block content %} <!-- the linked templates have matching block statements named "content" -->

<h1>Analysis</h1>
<hr/>


			<form class="form-horizontal" role="form" action="" method="post" name="analysis">

				{{ form.hidden_tag() }} <!-- template arg replaced with hidden field that implements the CSRF prevention -->

				<div class="form-group">
					<div class="container">
						<div class="row">
							<div class="col-md-4">
								<p>
									Campus: {{ form.campus() }}
									{% for error in form.campus.errors %} 
										<span style="color: red;">* {{ error }}</span>
									{% endfor %}<br>
								</p>
								<p>
									Building: {{ form.building() }}
									{% for error in form.building.errors %} 
										<span style="color: red;">* {{ error }}</span>
									{% endfor %}<br>
								</p>
								<p>
									Room: {{ form.room() }}
									{% for error in form.room.errors %} 
										<span style="color: red;">* {{ error }}</span>
									{% endfor %}<br>
								</p>
							</div>
							<div class="col-md-4">
								<p>
									Day: {{ form.day() }}
									{% for error in form.day.errors %} 
										<span style="color: red;">* {{ error }}</span>
									{% endfor %}<br>
								</p>
								<p>
									Time: {{ form.time() }}
									{% for error in form.time.errors %}
										<span style="color: red;">* {{ error }}</span>
									{% endfor %}<br>
								</p>
							</div>
							<div class="col-md-4">
								<p>
									Model: {{ form.model_type() }} <!-- error message: for loop renders errors added by the validators attached to field -->
									{% for error in form.model_type.errors %}
										<span style="color: red;">* {{ error }}</span>
									{% endfor %}<br>
								</p>
							</div>
						</div>
						<div class="row">
							<input type="submit" value="Display" class="btn btn-default">
						</div>
					</div>
				</div>

			</form>

			<hr/>

			<div class="container">
				<div class="row">
					<div class="col-md-3">
						<!-- JS drop down once form is submitted to display accuracy of model -->
						<div id="accuracy-scores"> 
							<ul>
								{% for a in accuracy %}
								<li> <b>{{ a }}</b>: {{ '%0.2f' % (accuracy[a]) }} </li>
								{% endfor %}
							</ul>
						</div>

						<div>
							{% if day_pred != "" %}
								
								{% if day_pred == "N/A" %}
									<p><b>Predicted Occupancy:</b> {{ day_pred }}</p>
								{% else %}
									<p><b>Predicted Occupancy
									{% if cate_model == True or svc == True %}
										Percentage: </b> {{ " " + day_pred|string + "%" }}
									{% else %}
										: </b> {{ " " + day_pred|round|int|string + " students" }}
									{% endif %}
								</p>
								{% endif %}
							{% endif %}
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12 col-xs-12 col-sm-12">
						<div id="chart_1"></div>
					</div>
				</div>
    		</div>


   
<!-- CHARTS-->

<!-- <div id="chart_perc"></div> -->
{% if df_chart_1 != "" %}
<!-- Google Chart -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>
google.charts.load('visualization', '1.1', {'packages': ['corechart']});

// Set a callback to run when the Google Visualization API is loaded.
google.charts.setOnLoadCallback(function () {

    // Create the data table.
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Time');
    data.addColumn('number', 'Predicted');
    data.addColumn('number', 'Occupancy');
  var results = []; // array to contain data for chart
  {% for i in df_chart_1 %}
      // add objects for chart
      results.push({time:"{{ i.time }}", predicted:{{ i.predicted }}, occupancy_number:
        {% if cate_model == False and svc == False %}
          {{ i.occupancy_number }}});
        {% else %}
          {{ i.occupancy * 100 }}});
      {% endif %}
  {% endfor %}
    for (i = 0; i < results.length; i++) {
        data.addRow([results[i].time, results[i].predicted, results[i].occupancy_number]);
    }
    // Set chart options
    var options = {title:'Estimated Occupancy per Hour',
                   // width:650,
                   // height:300,
                   vAxis: {title: "Number of Students"},
                   hAxis: {title: "Time"},
                   animation:{
                       duration: 1000,
                       easing: 'inAndOut',
                       startup: true
                   }
                  };

    var chart = new google.visualization.LineChart(document.getElementById('chart_1'));
    drawChart();

    function drawChart() {
        // Instantiate and draw our chart, passing in some options.
        chart.draw(data, options);
    }


    $(document).ready(function () {
        $(window).resize(function () {
            drawChart();
        });
    });
});
</script>

{% endif %}
        
{% endblock %}